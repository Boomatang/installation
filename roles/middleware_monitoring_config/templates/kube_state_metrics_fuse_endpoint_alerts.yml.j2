apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata: 
  labels:
    monitoring-key: "{{monitoring_label_value}}"
  name: ksm-fuse-endpoint-alerts
spec:   
  groups: 
    - name: fuse-endpoint.rules
      rules: 
      - alert: RHMIFuseBrokerAmqTcpEndpointDown
        annotations:
          sop_url: <TODO>
          message: >-
            No {{ "{{" }}$labels.endpoint{{ "}}" }} endpoints in namespace {{ "{{" }}$labels.namespace{{ "}}" }} is down. Expected at least 1.
        expr: |
          kube_endpoint_address_available{endpoint='broker-amq-tcp'} * on (namespace) group_left kube_namespace_labels{label_monitoring_key='middleware'} < 1
        for: 5m
        labels:
          severity: critical
      - alert: RHMISyndesisDbServiceEndpointDown
        annotations:
          sop_url: <TODO>
          message: >-
            No {{ "{{" }}$labels.endpoint{{ "}}" }} endpoints in namespace {{ "{{" }}$labels.namespace{{ "}}" }} is down. Expected at least 1.
        expr: |
          kube_endpoint_address_available{endpoint='syndesis-db'} * on (namespace) group_left kube_namespace_labels{label_monitoring_key='middleware'} < 1
        for: 5m
        labels:
          severity: critical
      - alert: RHMISyndesisMetaServiceEndpointDown
        annotations:
          sop_url: <TODO>
          message: >-
            No {{ "{{" }}$labels.endpoint{{ "}}" }} endpoints in namespace {{ "{{" }}$labels.namespace{{ "}}" }} is down. Expected at least 1.
        expr: |
          kube_endpoint_address_available{endpoint='syndesis-meta'} * on (namespace) group_left kube_namespace_labels{label_monitoring_key='middleware'} < 1
        for: 5m
        labels:
          severity: critical
      - alert: RHMISyndesisOauthproxyServiceEndpointDown
        annotations:
          sop_url: <TODO>
          message: >-
            No {{ "{{" }}$labels.endpoint{{ "}}" }} endpoints in namespace {{ "{{" }}$labels.namespace{{ "}}" }} is down. Expected at least 1.
        expr: |
          kube_endpoint_address_available{endpoint='syndesis-oauthproxy'} * on (namespace) group_left kube_namespace_labels{label_monitoring_key='middleware'} < 1
        for: 5m
        labels:
          severity: critical
      - alert: RHMISyndesisOperatorMetricsServiceEndpointDown
        annotations:
          sop_url: <TODO>
          message: >-
            No {{ "{{" }}$labels.endpoint{{ "}}" }} endpoints in namespace {{ "{{" }}$labels.namespace{{ "}}" }} is down. Expected at least 1.
        expr: |
          kube_endpoint_address_available{endpoint='syndesis-operator-metrics'} * on (namespace) group_left kube_namespace_labels{label_monitoring_key='middleware'} < 1
        for: 5m
        labels:
          severity: critical
      - alert: RHMISyndesisPrometheusServiceEndpointDown
        annotations:
          sop_url: <TODO>
          message: >-
            No {{ "{{" }}$labels.endpoint{{ "}}" }} endpoints in namespace {{ "{{" }}$labels.namespace{{ "}}" }} is down. Expected at least 1.
        expr: |
          kube_endpoint_address_available{endpoint='syndesis-prometheus'} * on (namespace) group_left kube_namespace_labels{label_monitoring_key='middleware'} < 1
        for: 5m
        labels:
          severity: critical
      - alert: RHMISyndesisServerServiceEndpointDown
        annotations:
          sop_url: <TODO>
          message: >-
            No {{ "{{" }}$labels.endpoint{{ "}}" }} endpoints in namespace {{ "{{" }}$labels.namespace{{ "}}" }} is down. Expected at least 1.
        expr: |
          kube_endpoint_address_available{endpoint='syndesis-server'} * on (namespace) group_left kube_namespace_labels{label_monitoring_key='middleware'} < 1
        for: 5m
        labels:
          severity: critical
      - alert: RHMISyndesisUiServiceEndpointDown
        annotations:
          sop_url: <TODO>
          message: >-
            No {{ "{{" }}$labels.endpoint{{ "}}" }} endpoints in namespace {{ "{{" }}$labels.namespace{{ "}}" }} is down. Expected at least 1.
        expr: |
          kube_endpoint_address_available{endpoint='syndesis-ui'} * on (namespace) group_left kube_namespace_labels{label_monitoring_key='middleware'} < 1
        for: 5m
        labels:
          severity: critical